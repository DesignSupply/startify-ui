/*
 * Startify-UI
 * This project is licensed under the MIT License.
 * (c) 2024-present Shinya Ogawa
*/
(()=>{"use strict";new class{constructor(e){this.dataNameAccordion=e.dataNameAccordion,this.dataNameAccordionSummary=e.dataNameAccordionSummary,this.dataNameAccordionDetail=e.dataNameAccordionDetail,this.duration=e.duration,this.easing=e.easing,this.accordionElements=document.querySelectorAll(`[data-su-js="${this.dataNameAccordion}"]`),this.init()}init(){Array.from(this.accordionElements).forEach((e=>{var t;const a=e;if(null===(t=a.querySelector("summary"))||void 0===t||t.addEventListener("click",(e=>{const t=e.currentTarget,n=a.querySelector(`.${this.dataNameAccordionDetail}`),i="true"===t.getAttribute("aria-expanded"),s="true"===n.getAttribute("aria-hidden");t.setAttribute("aria-expanded",String(!i)),n.setAttribute("aria-hidden",String(!s))})),a.matches(`[data-su-js="${this.dataNameAccordion}"]`)){const e=a.querySelector(`[data-su-js="${this.dataNameAccordionSummary}"]`),t=a.querySelector(`[data-su-js="${this.dataNameAccordionDetail}"]`);null==e||e.addEventListener("click",(e=>{e.preventDefault(),null!==a.getAttribute("open")?(null==t?void 0:t.animate(this.closingAnimation(t),{duration:this.duration,easing:this.easing})).onfinish=()=>{a.open=!1}:(a.open=!0,null==t||t.animate(this.openingAnimation(t),{duration:this.duration,easing:this.easing}))}))}}))}closingAnimation(e){return[{height:`${e.offsetHeight}px`,opacity:1},{height:0,opacity:0}]}openingAnimation(e){return[{height:0,opacity:0},{height:`${e.offsetHeight}px`,opacity:1}]}}({dataNameAccordion:"su-accordion",dataNameAccordionSummary:"su-accordion-summary",dataNameAccordionDetail:"su-accordion-detail",duration:400,easing:"ease-in-out"}),new class{constructor(e){this.handleEscapeKey=e=>{"Escape"===e.key&&(e.preventDefault(),this.modalElement.close())},this.dataNameModal=e.dataNameModal,this.dataNameModalOpen=e.dataNameModalOpen,this.dataNameModalClose=e.dataNameModalClose,this.modalElement=document.querySelector(`[data-su-js="${this.dataNameModal}"]`),this.modalOpenElement=document.querySelector(`[data-su-js="${this.dataNameModalOpen}"]`),this.modalCloseElement=document.querySelector(`[data-su-js="${this.dataNameModalClose}"]`),this.init()}init(){null!==this.modalElement&&null!==this.modalOpenElement&&null!==this.modalCloseElement&&(this.modalOpenElement.addEventListener("click",(e=>{this.open(e),this.toggleState(e.target)})),this.modalCloseElement.addEventListener("click",(e=>{this.close(e),this.toggleState(this.modalOpenElement)})),this.modalElement.addEventListener("click",(e=>{e.target===this.modalElement&&(this.close(e),this.toggleState(this.modalOpenElement))})))}open(e){e.preventDefault(),this.modalElement.showModal(),document.addEventListener("keydown",this.handleEscapeKey)}close(e){e.preventDefault(),this.modalElement.close(),document.removeEventListener("keydown",this.handleEscapeKey)}toggleState(e){const t="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",String(!t))}}({dataNameModal:"su-modal",dataNameModalOpen:"su-modal-open",dataNameModalClose:"su-modal-close"}),new class{constructor(e){this.dataNameRangeInput=e.dataNameRangeInput,this.dataNameRangeOutput=e.dataNameRangeOutput,this.rangeInputElements=document.querySelectorAll(`[data-su-js="${this.dataNameRangeInput}"]`),this.init()}init(){Array.from(this.rangeInputElements).forEach((e=>{var t;const a=e,n=null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(`[data-su-js="${this.dataNameRangeOutput}"]`);this.updateRangeBackground(a),n&&(n.textContent=this.updateRangeOutput(a).toString()),a.addEventListener("input",(e=>{this.updateRangeBackground(e.target),n&&(n.textContent=this.updateRangeOutput(e.target).toString())})),window.addEventListener("resize",(()=>{this.updateRangeBackground(a)}))}))}remToPx(e){return e*parseFloat(window.getComputedStyle(document.documentElement).fontSize)}updateRangeBackground(e){const t=Number(e.value),a=Number(e.max),n=Number(e.min)||0,i=window.getComputedStyle(e).getPropertyValue("--su-size-button-range-input").trim();let s;if(i)if(i.endsWith("rem")){const e=parseFloat(i.replace("rem",""));s=this.remToPx(e)}else s=i.endsWith("px")?parseFloat(i.replace("px","")):(isNaN(parseFloat(i)),0);else s=0;const l=s/e.getBoundingClientRect().width*100,r=a-n,u=0===l?(t-n)/r*100:(t-n)/r*(100-l)+l/2;e.style.background=`linear-gradient(to right, \n      var(--su-color-fill-bar-range-input) 0%, \n      var(--su-color-fill-bar-range-input) ${u}%, \n      var(--su-color-bg-bar-range-input) ${u}%, \n      var(--su-color-bg-bar-range-input) 100%)\n    `}updateRangeOutput(e){return Number(e.value)}}({dataNameRangeInput:"su-form-range-input",dataNameRangeOutput:"su-form-range-output"}),new class{constructor(e){this.dataNameRangeInputMultiple=e.dataNameRangeInputMultiple,this.dataNameRangeInputMultipleMin=e.dataNameRangeInputMultipleMin,this.dataNameRangeInputMultipleMax=e.dataNameRangeInputMultipleMax,this.dataNameRangeOutputMultipleMin=e.dataNameRangeOutputMultipleMin,this.dataNameRangeOutputMultipleMax=e.dataNameRangeOutputMultipleMax,this.rangeInputMultipleElements=document.querySelectorAll(`[data-su-js="${this.dataNameRangeInputMultiple}"]`),this.init()}init(){Array.from(this.rangeInputMultipleElements).forEach((e=>{const t=e,a=t.querySelector(`[data-su-js="${this.dataNameRangeInputMultipleMin}"]`),n=t.querySelector(`[data-su-js="${this.dataNameRangeInputMultipleMax}"]`),i=document.querySelector(`[data-su-js="${this.dataNameRangeOutputMultipleMin}"]`),s=document.querySelector(`[data-su-js="${this.dataNameRangeOutputMultipleMax}"]`);this.constrainRangeValues(a,n),this.updateRangeBackgrounds(a,n),this.updateOutputValues(a,n,i,s),a.addEventListener("input",(()=>{this.constrainRangeValues(a,n),this.updateRangeBackgrounds(a,n),this.updateOutputValues(a,n,i,s)})),n.addEventListener("input",(()=>{this.constrainRangeValues(a,n),this.updateRangeBackgrounds(a,n),this.updateOutputValues(a,n,i,s)})),window.addEventListener("resize",(()=>{this.updateRangeBackgrounds(a,n)}))}))}constrainRangeValues(e,t){const a=Number(e.value),n=Number(t.value),i=Number(e.min)||0,s=Number(e.max)||100,l=Number(e.step)||1,r=Math.max(l,.01*(s-i));if(a>n-r){const t=Math.max(i,n-r);e.value=t.toString()}if(n<a+r){const e=Math.min(s,a+r);t.value=e.toString()}}updateOutputValues(e,t,a,n){a&&(a.textContent=e.value),n&&(n.textContent=t.value)}remToPx(e){return e*parseFloat(window.getComputedStyle(document.documentElement).fontSize)}updateRangeBackgrounds(e,t){const a=Number(e.value),n=Number(t.value),i=Number(e.min)||0,s=Number(e.max)||100,l=this.getThumbSizePx(e)/e.getBoundingClientRect().width*100,r=s-i,u=0===l?(a-i)/r*100:(a-i)/r*(100-l)+l/2,o=0===l?(n-i)/r*100:(n-i)/r*(100-l)+l/2;t.style.background=`linear-gradient(to right, \n      var(--su-color-bg-bar-range-input) 0%, \n      var(--su-color-bg-bar-range-input) ${u}%, \n      var(--su-color-fill-bar-range-input) ${u}%, \n      var(--su-color-fill-bar-range-input) ${o}%, \n      var(--su-color-bg-bar-range-input) ${o}%, \n      var(--su-color-bg-bar-range-input) 100%)\n    `}getThumbSizePx(e){const t=window.getComputedStyle(e).getPropertyValue("--su-size-button-range-input").trim();if(t){if(t.endsWith("rem")){const e=parseFloat(t.replace("rem",""));return this.remToPx(e)}if(t.endsWith("px"))return parseFloat(t.replace("px",""))}return 0}}({dataNameRangeInputMultiple:"su-form-range-input-multiple",dataNameRangeInputMultipleMin:"su-form-range-input-multiple-min",dataNameRangeInputMultipleMax:"su-form-range-input-multiple-max",dataNameRangeOutputMultipleMin:"su-form-range-output-multiple-min",dataNameRangeOutputMultipleMax:"su-form-range-output-multiple-max"}),new class{constructor(e){this.selectedFilesMap=new Map,this.fileConstraintsMap=new Map,this.dataNameFileInput=e.dataNameFileInput,this.dataNameFileInputList=e.dataNameFileInputList,this.dataNameFileInputFileName=e.dataNameFileInputFileName,this.dataNameFileInputFileRemove=e.dataNameFileInputFileRemove,this.dataNameFileInputThumbnailPreview=e.dataNameFileInputThumbnailPreview,this.dataNameFileInputThumbnailRemove=e.dataNameFileInputThumbnailRemove,this.fileInputElements=document.querySelectorAll(`[data-su-js="${this.dataNameFileInput}"]`),this.init()}init(){Array.from(this.fileInputElements).forEach((e=>{const t=e,a=null==t?void 0:t.querySelector('input[type="file"]');this.selectedFilesMap.set(t,[]),this.readConstraints(t),a.addEventListener("input",(e=>{const a=e.target,n=this.validateFiles(t,a.files);n.valid?this.selectFiles(t,a):(alert(n.errors.join("\n")),a.value="")})),t.addEventListener("click",(e=>{const a=e.target.closest(`[data-su-js="${this.dataNameFileInputFileRemove}"]`);a&&this.removeFile(t,a)})),t.addEventListener("click",(e=>{const a=e.target.closest(`[data-su-js="${this.dataNameFileInputThumbnailRemove}"]`);a&&this.removeThumbnail(t,a)}))}))}selectFiles(e,t){const a=Array.from(t.files||[]),n=[...this.selectedFilesMap.get(e)||[],...a];this.selectedFilesMap.set(e,n);const i=new DataTransfer;n.forEach((e=>{i.items.add(e)})),t.files=i.files,this.displaySelectedFiles(e),this.displayThumbnailPreview(e)}displaySelectedFiles(e){const t=null==e?void 0:e.querySelector(`[data-su-js="${this.dataNameFileInputList}"]`),a=this.selectedFilesMap.get(e)||[];t&&(a.length>0?t.style.display="grid":t.style.display="none",t.replaceChildren(),a.forEach(((e,a)=>{const n=e.name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),i=this.formatFileSize(e.size),s=`\n          <div \n            class="su-form-file-input-list-item" \n            data-file-index="${a}" \n            role="listitem"\n          >\n            <button \n              type="button" \n              class="su-form-file-input-file-remove" \n              data-su-js="${this.dataNameFileInputFileRemove}"\n              aria-label="${n} (${i}) を削除"\n            >\n              <span \n                class="su-icon-delete su-form-file-input-file-remove-icon" \n                aria-hidden="true"\n              ></span>\n            </button>\n            <span class="su-form-file-input-file-name">${n}</span>\n          </div>\n        `;t.insertAdjacentHTML("beforeend",s)})))}displayThumbnailPreview(e){const t=null==e?void 0:e.querySelector(`[data-su-js="${this.dataNameFileInputThumbnailPreview}"]`),a=this.selectedFilesMap.get(e)||[];t&&(a.length>0?t.style.display="flex":t.style.display="none"),null==t||t.replaceChildren(),a.forEach(((e,a)=>{const n=e.name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),i=e.type,s=this.formatFileSize(e.size);let l="";l=i.startsWith("image/")?"画像":i.startsWith("video/")?"動画":"ファイル";const r=`\n        <figure \n          class="su-form-file-input-thumbnail-preview-thumbnail" \n          data-file-index="${a}"\n          role="listitem"\n        >\n          ${e.type.startsWith("image/")?`\n            <img \n              src="${URL.createObjectURL(e)}" \n              alt="${n} ${l}" \n              class="su-form-file-input-thumbnail-preview-image" \n            />\n          `:e.type.startsWith("video/")?`\n            <canvas \n              class="su-form-file-input-thumbnail-preview-canvas" \n              data-video-src="${URL.createObjectURL(e)}"\n              data-su-js="su-form-file-input-thumbnail-preview-canvas"\n              aria-label="${n} ${l}"\n            ></canvas>\n            <figcaption \n              class="su-form-file-input-thumbnail-preview-duration"\n              data-su-js="su-form-file-input-thumbnail-preview-duration"\n            ></figcaption>\n          `:`\n            <span \n              class="su-form-file-input-thumbnail-preview-file"\n              aria-label="${n} ${l}"\n            >\n              <span \n                class="su-icon-document su-form-file-input-thumbnail-preview-file-icon"\n                aria-hidden="true"\n              ></span>\n            </span>\n          `}\n          <button \n            type="button" \n            class="su-form-file-input-thumbnail-preview-remove"\n            data-su-js="${this.dataNameFileInputThumbnailRemove}"\n            aria-label="${n} (${s}) のサムネイルを削除"\n          >\n            <span \n              class="su-icon-delete su-form-file-input-file-remove-icon"\n              aria-hidden="true"\n            ></span>\n          </button>\n        </figure>\n      `;null==t||t.insertAdjacentHTML("beforeend",r)})),this.generateVideoThumbnails(t)}generateVideoThumbnails(e){if(!e)return;const t=Array.from(e.querySelectorAll('[data-su-js="su-form-file-input-thumbnail-preview-canvas"]')),a=Array.from(e.querySelectorAll('[data-su-js="su-form-file-input-thumbnail-preview-duration"]')),n=(e=0)=>{if(e>=t.length)return;const i=t[e],s=a[e],l=i.getAttribute("data-video-src");if(!l)return void n(e+1);const r=document.createElement("video");r.style.display="none",r.src=l,r.muted=!0,r.controls=!1,r.addEventListener("loadedmetadata",(()=>{const e=r.duration,t=Math.floor(e/60),a=Math.floor(e%60),n=document.createTextNode(`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`);s.appendChild(n),r.currentTime=.1})),r.addEventListener("seeked",(()=>{const t=i.getContext("2d");t&&(i.width=r.videoWidth,i.height=r.videoHeight,t.drawImage(r,0,0,i.width,i.height),setTimeout((()=>{URL.revokeObjectURL(l),r.remove(),n(e+1)}),100))})),r.addEventListener("error",(()=>{s.textContent="--:--:--",setTimeout((()=>{URL.revokeObjectURL(l),r.remove(),n(e+1)}),100)})),document.body.appendChild(r)};n()}removeFile(e,t){const a=t.closest(".su-form-file-input-list-item");if(a){const t=parseInt(a.getAttribute("data-file-index")||"-1");if(t>=0){const a=this.selectedFilesMap.get(e)||[];a.splice(t,1),this.selectedFilesMap.set(e,a);const n=null==e?void 0:e.querySelector('input[type="file"]'),i=new DataTransfer;a.forEach((e=>{i.items.add(e)})),n.files=i.files,this.displaySelectedFiles(e),this.displayThumbnailPreview(e)}}}removeThumbnail(e,t){const a=t.closest(".su-form-file-input-thumbnail-preview-thumbnail");if(a){const t=parseInt(a.getAttribute("data-file-index")||"-1");if(t>=0){const a=this.selectedFilesMap.get(e)||[];a.splice(t,1),this.selectedFilesMap.set(e,a);const n=null==e?void 0:e.querySelector('input[type="file"]'),i=new DataTransfer;a.forEach((e=>{i.items.add(e)})),n.files=i.files,this.displaySelectedFiles(e),this.displayThumbnailPreview(e)}}}readConstraints(e){const t=e.getAttribute("data-su-file-constraints");if(t)try{const a=JSON.parse(t);this.fileConstraintsMap.set(e,a)}catch(e){console.error("Error parsing file constraints:",e)}}validateFiles(e,t){const a=this.fileConstraintsMap.get(e),n=[];if(!a||!t||0===t.length)return{valid:!0,errors:n};const i=(this.selectedFilesMap.get(e)||[]).length+t.length;return a.maxCount&&i>a.maxCount&&n.push(`・選択可能なファイル数を超えています。【最大${a.maxCount}ファイル】まで選択できます。`),Array.from(t).forEach((e=>{var t;if(a.accept&&a.accept.length>0){const i="."+(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase());if(!a.accept.some((t=>t.startsWith(".")?t.toLowerCase()===i:t.includes("/")?e.type.match(new RegExp(t.replace("*",".*"))):i===`.${t.toLowerCase()}`))){const e=a.accept.join(", ");n.push(`・許可されていないファイル形式が含まれています。【${e}】のファイル形式のみ許可されています。`)}}if(a.maxSize){const t="number"==typeof a.maxSize?a.maxSize:this.convertSizeToBytes(a.maxSize);if(e.size>t){const e=Math.round(t/1024/1024*10)/10;n.push(`・ファイルサイズが大きいものが含まれています。【${e}MB】以下のファイルを選択してください。`)}}})),{valid:0===n.length,errors:[...new Set(n)]}}convertSizeToBytes(e){const t=e.match(/^(\d+(?:\.\d+)?)\s*(KB|MB|GB|B)?$/i);if(!t)return 0;const a=parseFloat(t[1]);switch((t[2]||"B").toUpperCase()){case"KB":return 1024*a;case"MB":return 1024*a*1024;case"GB":return 1024*a*1024*1024;default:return a}}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}}({dataNameFileInput:"su-form-file-input",dataNameFileInputList:"su-form-file-input-list",dataNameFileInputFileName:"su-form-file-input-file-name",dataNameFileInputFileRemove:"su-form-file-input-file-remove",dataNameFileInputThumbnailPreview:"su-form-file-input-thumbnail-preview",dataNameFileInputThumbnailRemove:"su-form-file-input-thumbnail-remove"})})();